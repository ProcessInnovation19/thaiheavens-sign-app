import{_ as d,C as h,c as E,o as e,ah as p,b as l,j as n,w as i,a,G as r,ai as o}from"./chunks/framework.D--hi4lz.js";const b=JSON.parse('{"title":"API Flow Documentation","description":"","frontmatter":{},"headers":[],"relativePath":"api_flow.md","filePath":"api_flow.md"}'),u={name:"api_flow.md"};function k(A,s,c,g,F,S){const t=h("Mermaid");return e(),E("div",null,[s[14]||(s[14]=p("",4)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-12",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5BFrontend%5D%20--%3E%7CHTTP%20Request%7C%20B%5BExpress%20Router%5D%0A%20%20%20%20B%20--%3E%20C%7BRoute%20Handler%7D%0A%20%20%20%20C%20--%3E%20D%5BService%20Layer%5D%0A%20%20%20%20D%20--%3E%20E%5BFile%20System%5D%0A%20%20%20%20E%20--%3E%20D%0A%20%20%20%20D%20--%3E%20C%0A%20%20%20%20C%20--%3E%7CJSON%20Response%7C%20A%0A"})]),fallback:i(()=>[...s[0]||(s[0]=[a(" Loading... ",-1)])]),_:1})),s[15]||(s[15]=p("",4)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-52",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20M%20as%20Multer%0A%20%20%20%20participant%20U%20as%20Upload%20Route%0A%20%20%20%20participant%20S%20as%20Storage%20Service%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3EU%3A%20POST%20%2Fapi%2Fupload-pdf%3Cbr%2F%3E(multipart%2Fform-data)%0A%20%20%20%20U-%3E%3EM%3A%20Handle%20file%20upload%0A%20%20%20%20M-%3E%3EFS%3A%20Save%20to%20uploads%2F%20(temp)%0A%20%20%20%20FS--%3E%3EM%3A%20Temp%20file%20path%0A%20%20%20%20M--%3E%3EU%3A%20req.file%0A%20%20%20%20U-%3E%3ES%3A%20Generate%20pdfId%20(UUID)%0A%20%20%20%20U-%3E%3EFS%3A%20Move%20file%20to%20storage%2Foriginal%2F%0A%20%20%20%20FS--%3E%3EU%3A%20Success%0A%20%20%20%20U--%3E%3EF%3A%20%7BpdfId%2C%20filePath%7D%0A"})]),fallback:i(()=>[...s[1]||(s[1]=[a(" Loading... ",-1)])]),_:1})),s[16]||(s[16]=p("",10)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-97",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20SR%20as%20Session%20Route%0A%20%20%20%20participant%20S%20as%20Storage%20Service%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3ESR%3A%20POST%20%2Fapi%2Fcreate-session%3Cbr%2F%3E%7BpdfId%2C%20guestName%2C%20guestEmail%2C%3Cbr%2F%3Epage%2C%20x%2C%20y%2C%20width%2C%20height%7D%0A%20%20%20%20SR-%3E%3ESR%3A%20Validate%20input%0A%20%20%20%20SR-%3E%3ESR%3A%20Generate%20sessionId%20(UUID)%0A%20%20%20%20SR-%3E%3ESR%3A%20Generate%20token%20(UUID%20no%20dashes)%0A%20%20%20%20SR-%3E%3ES%3A%20Create%20SigningSession%20object%0A%20%20%20%20S-%3E%3EFS%3A%20Read%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Existing%20sessions%0A%20%20%20%20S-%3E%3ES%3A%20Add%20new%20session%0A%20%20%20%20S-%3E%3EFS%3A%20Write%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Success%0A%20%20%20%20S--%3E%3ESR%3A%20Session%20created%0A%20%20%20%20SR-%3E%3ESR%3A%20Build%20publicUrl%0A%20%20%20%20SR--%3E%3EF%3A%20%7BsessionId%2C%20token%2C%20publicUrl%7D%0A"})]),fallback:i(()=>[...s[2]||(s[2]=[a(" Loading... ",-1)])]),_:1})),s[17]||(s[17]=p("",10)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-131",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20SR%20as%20Session%20Route%0A%20%20%20%20participant%20S%20as%20Storage%20Service%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3ESR%3A%20GET%20%2Fapi%2Fsession%2F%3Atoken%0A%20%20%20%20SR-%3E%3ES%3A%20getSessionByToken(token)%0A%20%20%20%20S-%3E%3EFS%3A%20Read%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20All%20sessions%0A%20%20%20%20S-%3E%3ES%3A%20Find%20session%20by%20token%0A%20%20%20%20alt%20Session%20Found%0A%20%20%20%20%20%20%20%20S-%3E%3ES%3A%20Build%20public%20info%20(no%20internal%20paths)%0A%20%20%20%20%20%20%20%20S--%3E%3ESR%3A%20SessionPublicInfo%0A%20%20%20%20%20%20%20%20SR--%3E%3EF%3A%20%7Bid%2C%20token%2C%20guestName%2C%20status%2C%3Cbr%2F%3EpdfViewUrl%2C%20page%7D%0A%20%20%20%20else%20Session%20Not%20Found%0A%20%20%20%20%20%20%20%20S--%3E%3ESR%3A%20undefined%0A%20%20%20%20%20%20%20%20SR--%3E%3EF%3A%20404%20Not%20Found%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[3]||(s[3]=[a(" Loading... ",-1)])]),_:1})),s[18]||(s[18]=p("",9)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-153",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20SR%20as%20Session%20Route%0A%20%20%20%20participant%20PS%20as%20PDF%20Service%0A%20%20%20%20participant%20S%20as%20Storage%20Service%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3ESR%3A%20POST%20%2Fapi%2Fsession%2F%3Atoken%2Fsign%3Cbr%2F%3E%7BsignatureImageBase64%7D%0A%20%20%20%20SR-%3E%3ES%3A%20getSessionByToken(token)%0A%20%20%20%20S-%3E%3EFS%3A%20Read%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Session%20data%0A%20%20%20%20S--%3E%3ESR%3A%20Session%20object%0A%20%20%20%20SR-%3E%3ESR%3A%20Extract%20base64%20data%0A%20%20%20%20SR-%3E%3EPS%3A%20applySignatureToPdf(session%2C%20base64)%0A%20%20%20%20PS-%3E%3EFS%3A%20Read%20original%20PDF%0A%20%20%20%20FS--%3E%3EPS%3A%20PDF%20bytes%0A%20%20%20%20PS-%3E%3EPS%3A%20Load%20PDF%20with%20pdf-lib%0A%20%20%20%20PS-%3E%3EPS%3A%20Convert%20base64%20to%20PNG%0A%20%20%20%20PS-%3E%3EPS%3A%20Embed%20PNG%20in%20PDF%0A%20%20%20%20Note%20over%20PS%3A%20Coordinate%20conversion%3A%3Cbr%2F%3EpdfY%20%3D%20pageHeight%20-%20y%20-%20height%0A%20%20%20%20PS-%3E%3EFS%3A%20Save%20signed%20PDF%0A%20%20%20%20FS--%3E%3EPS%3A%20Success%0A%20%20%20%20PS-%3E%3ES%3A%20Update%20session%20(signedPdfPath%2C%20status)%0A%20%20%20%20S-%3E%3EFS%3A%20Update%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Success%0A%20%20%20%20PS--%3E%3ESR%3A%20Signed%20PDF%20path%0A%20%20%20%20SR-%3E%3ESR%3A%20Build%20preview%20URL%0A%20%20%20%20SR--%3E%3EF%3A%20%7BsignedPdfUrl%2C%20sessionId%7D%0A"})]),fallback:i(()=>[...s[4]||(s[4]=[a(" Loading... ",-1)])]),_:1})),s[19]||(s[19]=p("",10)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-187",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20SR%20as%20Session%20Route%0A%20%20%20%20participant%20S%20as%20Storage%20Service%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3ESR%3A%20POST%20%2Fapi%2Fsession%2F%3Atoken%2Fconfirm%0A%20%20%20%20SR-%3E%3ES%3A%20getSessionByToken(token)%0A%20%20%20%20S-%3E%3EFS%3A%20Read%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Session%20data%0A%20%20%20%20S--%3E%3ESR%3A%20Session%20object%0A%20%20%20%20SR-%3E%3ES%3A%20Update%20session%20status%20to%20%22completed%22%0A%20%20%20%20S-%3E%3EFS%3A%20Update%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Success%0A%20%20%20%20S--%3E%3ESR%3A%20Success%0A%20%20%20%20SR--%3E%3EF%3A%20%7Bsuccess%3A%20true%7D%0A"})]),fallback:i(()=>[...s[5]||(s[5]=[a(" Loading... ",-1)])]),_:1})),s[20]||(s[20]=p("",9)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-220",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20AR%20as%20Admin%20Route%0A%20%20%20%20participant%20S%20as%20Storage%20Service%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3EAR%3A%20GET%20%2Fapi%2Fadmin%2Fsessions%0A%20%20%20%20AR-%3E%3ES%3A%20getSessions()%0A%20%20%20%20S-%3E%3EFS%3A%20Read%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Sessions%20array%0A%20%20%20%20S--%3E%3EAR%3A%20All%20sessions%20(full%20objects)%0A%20%20%20%20AR--%3E%3EF%3A%20%5Bsessions%20array%5D%0A"})]),fallback:i(()=>[...s[6]||(s[6]=[a(" Loading... ",-1)])]),_:1})),s[21]||(s[21]=n("h3",{id:"download-signed-pdf",tabindex:"-1"},[a("Download Signed PDF "),n("a",{class:"header-anchor",href:"#download-signed-pdf","aria-label":'Permalink to "Download Signed PDF"'},"​")],-1)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-224",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20AR%20as%20Admin%20Route%0A%20%20%20%20participant%20S%20as%20Storage%20Service%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3EAR%3A%20GET%20%2Fapi%2Fadmin%2Fsession%2F%3Aid%2Fdownload-signed%0A%20%20%20%20AR-%3E%3ES%3A%20getSessionById(id)%0A%20%20%20%20S-%3E%3EFS%3A%20Read%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Session%20data%0A%20%20%20%20S--%3E%3EAR%3A%20Session%20object%0A%20%20%20%20AR-%3E%3EAR%3A%20Check%20status%20%3D%3D%3D%20%22completed%22%0A%20%20%20%20AR-%3E%3EFS%3A%20Read%20signed%20PDF%20file%0A%20%20%20%20FS--%3E%3EAR%3A%20PDF%20file%20stream%0A%20%20%20%20AR--%3E%3EF%3A%20PDF%20download%3Cbr%2F%3E(Content-Disposition%3A%20attachment)%0A"})]),fallback:i(()=>[...s[7]||(s[7]=[a(" Loading... ",-1)])]),_:1})),s[22]||(s[22]=n("h3",{id:"delete-session",tabindex:"-1"},[a("Delete Session "),n("a",{class:"header-anchor",href:"#delete-session","aria-label":'Permalink to "Delete Session"'},"​")],-1)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-228",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20AR%20as%20Admin%20Route%0A%20%20%20%20participant%20S%20as%20Storage%20Service%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3EAR%3A%20DELETE%20%2Fapi%2Fadmin%2Fsession%2F%3Aid%0A%20%20%20%20AR-%3E%3ES%3A%20deleteSession(id)%0A%20%20%20%20S-%3E%3EFS%3A%20Read%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Sessions%20array%0A%20%20%20%20S-%3E%3ES%3A%20Find%20session%0A%20%20%20%20S-%3E%3EFS%3A%20Delete%20signed%20PDF%20(if%20exists)%0A%20%20%20%20FS--%3E%3ES%3A%20Success%0A%20%20%20%20S-%3E%3EFS%3A%20Remove%20from%20sessions.json%0A%20%20%20%20FS--%3E%3ES%3A%20Success%0A%20%20%20%20S--%3E%3EAR%3A%20Success%0A%20%20%20%20AR--%3E%3EF%3A%20%7Bsuccess%3A%20true%7D%0A"})]),fallback:i(()=>[...s[8]||(s[8]=[a(" Loading... ",-1)])]),_:1})),s[23]||(s[23]=n("hr",null,null,-1)),s[24]||(s[24]=n("h2",{id:"pdf-streaming-api-flow",tabindex:"-1"},[a("PDF Streaming API Flow "),n("a",{class:"header-anchor",href:"#pdf-streaming-api-flow","aria-label":'Permalink to "PDF Streaming API Flow"'},"​")],-1)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-233",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20PR%20as%20PDF%20Route%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3EPR%3A%20GET%20%2Fapi%2Fpdf%2F%3ApdfId%0A%20%20%20%20PR-%3E%3EFS%3A%20Read%20PDF%20from%20storage%2Foriginal%2F%0A%20%20%20%20alt%20File%20Exists%0A%20%20%20%20%20%20%20%20FS--%3E%3EPR%3A%20PDF%20file%20stream%0A%20%20%20%20%20%20%20%20PR-%3E%3EPR%3A%20Set%20Content-Type%3A%20application%2Fpdf%0A%20%20%20%20%20%20%20%20PR--%3E%3EF%3A%20PDF%20stream%0A%20%20%20%20else%20File%20Not%20Found%0A%20%20%20%20%20%20%20%20FS--%3E%3EPR%3A%20Error%0A%20%20%20%20%20%20%20%20PR--%3E%3EF%3A%20404%20Not%20Found%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[9]||(s[9]=[a(" Loading... ",-1)])]),_:1})),s[25]||(s[25]=p("",8)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-269",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20CR%20as%20Calibrate%20Route%0A%20%20%20%20participant%20PS%20as%20PDF%20Service%0A%20%20%20%20participant%20FS%20as%20File%20System%0A%20%20%20%20%0A%20%20%20%20F-%3E%3ECR%3A%20POST%20%2Fapi%2Fcalibrate%2Ftest-pdf%3Cbr%2F%3E%7BpdfId%2C%20page%2C%20x%2C%20y%2C%20width%2C%20height%2C%3Cbr%2F%3EsignatureImageBase64%3F%7D%0A%20%20%20%20CR-%3E%3EFS%3A%20Read%20original%20PDF%0A%20%20%20%20FS--%3E%3ECR%3A%20PDF%20bytes%0A%20%20%20%20CR-%3E%3EPS%3A%20Load%20PDF%20with%20pdf-lib%0A%20%20%20%20alt%20Signature%20Provided%0A%20%20%20%20%20%20%20%20CR-%3E%3EPS%3A%20Embed%20signature%20at%20coordinates%0A%20%20%20%20else%20No%20Signature%0A%20%20%20%20%20%20%20%20CR-%3E%3EPS%3A%20Draw%20red%20rectangle%20at%20coordinates%0A%20%20%20%20end%0A%20%20%20%20PS-%3E%3EPS%3A%20Generate%20modified%20PDF%0A%20%20%20%20PS--%3E%3ECR%3A%20PDF%20bytes%20(Uint8Array)%0A%20%20%20%20CR-%3E%3ECR%3A%20Convert%20to%20Buffer%0A%20%20%20%20CR-%3E%3ECR%3A%20Set%20Content-Type%3A%20application%2Fpdf%0A%20%20%20%20CR--%3E%3EF%3A%20PDF%20stream%20(inline)%0A"})]),fallback:i(()=>[...s[10]||(s[10]=[a(" Loading... ",-1)])]),_:1})),s[26]||(s[26]=p("",8)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-299",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20A%5BAPI%20Request%5D%20--%3E%20B%7BValidate%20Input%7D%0A%20%20%20%20B%20--%3E%7CInvalid%7C%20C%5B400%20Bad%20Request%5D%0A%20%20%20%20B%20--%3E%7CValid%7C%20D%7BResource%20Exists%3F%7D%0A%20%20%20%20D%20--%3E%7CNo%7C%20E%5B404%20Not%20Found%5D%0A%20%20%20%20D%20--%3E%7CYes%7C%20F%7BProcess%20Request%7D%0A%20%20%20%20F%20--%3E%7CError%7C%20G%5B500%20Server%20Error%5D%0A%20%20%20%20F%20--%3E%7CSuccess%7C%20H%5B200%20OK%5D%0A%20%20%20%20%0A%20%20%20%20C%20--%3E%20I%5BJSON%20Error%20Response%5D%0A%20%20%20%20E%20--%3E%20I%0A%20%20%20%20G%20--%3E%20I%0A%20%20%20%20H%20--%3E%20J%5BJSON%20Success%20Response%5D%0A"})]),fallback:i(()=>[...s[11]||(s[11]=[a(" Loading... ",-1)])]),_:1})),s[27]||(s[27]=p("",7)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-336",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20A%20as%20Auth%20Middleware%0A%20%20%20%20participant%20R%20as%20Route%20Handler%0A%20%20%20%20participant%20S%20as%20Service%0A%20%20%20%20%0A%20%20%20%20F-%3E%3ER%3A%20Request%20with%20token%0A%20%20%20%20R-%3E%3EA%3A%20Check%20authentication%0A%20%20%20%20alt%20Valid%20Token%0A%20%20%20%20%20%20%20%20A-%3E%3EA%3A%20Verify%20JWT%0A%20%20%20%20%20%20%20%20A--%3E%3ER%3A%20Authenticated%0A%20%20%20%20%20%20%20%20R-%3E%3ES%3A%20Process%20request%0A%20%20%20%20%20%20%20%20S--%3E%3ER%3A%20Result%0A%20%20%20%20%20%20%20%20R--%3E%3EF%3A%20Success%20response%0A%20%20%20%20else%20Invalid%20Token%0A%20%20%20%20%20%20%20%20A--%3E%3ER%3A%20Unauthorized%0A%20%20%20%20%20%20%20%20R--%3E%3EF%3A%20401%20Unauthorized%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[12]||(s[12]=[a(" Loading... ",-1)])]),_:1})),s[28]||(s[28]=n("h3",{id:"future-authentication",tabindex:"-1"},[a("Future Authentication "),n("a",{class:"header-anchor",href:"#future-authentication","aria-label":'Permalink to "Future Authentication"'},"​")],-1)),s[29]||(s[29]=n("p",null,[n("strong",null,"Current State:"),a(" No authentication "),n("strong",null,"Future:"),a(" Add JWT-based authentication for admin routes")],-1)),s[30]||(s[30]=n("hr",null,null,-1)),s[31]||(s[31]=n("h2",{id:"api-rate-limiting-flow-future",tabindex:"-1"},[a("API Rate Limiting Flow (Future) "),n("a",{class:"header-anchor",href:"#api-rate-limiting-flow-future","aria-label":'Permalink to "API Rate Limiting Flow (Future)"'},"​")],-1)),(e(),l(o,null,{default:i(()=>[r(t,{id:"mermaid-347",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20F%20as%20Frontend%0A%20%20%20%20participant%20RL%20as%20Rate%20Limiter%0A%20%20%20%20participant%20R%20as%20Route%20Handler%0A%20%20%20%20%0A%20%20%20%20F-%3E%3ERL%3A%20Request%0A%20%20%20%20RL-%3E%3ERL%3A%20Check%20rate%20limit%0A%20%20%20%20alt%20Within%20Limit%0A%20%20%20%20%20%20%20%20RL-%3E%3ER%3A%20Allow%20request%0A%20%20%20%20%20%20%20%20R--%3E%3EF%3A%20Response%0A%20%20%20%20else%20Exceeded%20Limit%0A%20%20%20%20%20%20%20%20RL--%3E%3EF%3A%20429%20Too%20Many%20Requests%0A%20%20%20%20end%0A"})]),fallback:i(()=>[...s[13]||(s[13]=[a(" Loading... ",-1)])]),_:1})),s[32]||(s[32]=p("",27))])}const C=d(u,[["render",k]]);export{b as __pageData,C as default};
